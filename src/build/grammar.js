// Generated automatically by nearley, version 2.19.6
// http://github.com/Hardmath123/nearley
(function () {
function id(x) { return x[0]; }

const moo = require("moo");

const lexer = moo.compile({
  ws: { match: /\s+/, lineBreaks: true },
  unsigned_integer_tk: /[0-9]+/,
  word: /[a-z]+/,
  lp: /\(/,
  comma: /,/,
  rp: /\)/,
  lb: /\{/,
  rb: /\}/,
  ls: /\[/,
  rs: /\]/,
  underscore: /_/,
  colon: /:/,
  prime: /'/,
  gt: />/,
  lt: /</,
  comment: /\/\/.*?$/,
  slash: /\//,
});


const Fraction = require("fraction.js");


// Beat ratio
const dbr = new Fraction(1);
// Container size
const dpd = { length: 4, beatRatio: dbr };
var grammar = {
    Lexer: lexer,
    ParserRules: [
    {"name": "nestup$ebnf$1", "symbols": []},
    {"name": "nestup$ebnf$1", "symbols": ["nestup$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "nestup", "symbols": ["nestup$ebnf$1"], "postprocess": d => []},
    {"name": "nestup$ebnf$2", "symbols": []},
    {"name": "nestup$ebnf$2", "symbols": ["nestup$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "nestup", "symbols": ["container_list_or_subdivisions", "nestup$ebnf$2"], "postprocess": d => d[0]},
    {"name": "container_list_or_subdivisions$ebnf$1", "symbols": []},
    {"name": "container_list_or_subdivisions$ebnf$1", "symbols": ["container_list_or_subdivisions$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "container_list_or_subdivisions", "symbols": ["container_list_or_subdivisions$ebnf$1", "subdivisions"], "postprocess": d => { return [{ dimension: undefined, subdivisions: d[1] }] }},
    {"name": "container_list_or_subdivisions", "symbols": ["container_list"], "postprocess": d => d[0]},
    {"name": "container_list", "symbols": ["container"]},
    {"name": "container_list", "symbols": ["container", "container_list"], "postprocess": d => { return [d[0]].concat(d[1]) }},
    {"name": "container_list$ebnf$1", "symbols": []},
    {"name": "container_list$ebnf$1", "symbols": ["container_list$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "container_list", "symbols": ["container", "container_list$ebnf$1", (lexer.has("underscore") ? {type: "underscore"} : underscore), "container_list"], "postprocess": d => { d[0].tie = true; return [d[0]].concat(d[3]); }},
    {"name": "container$ebnf$1", "symbols": []},
    {"name": "container$ebnf$1", "symbols": ["container$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "container", "symbols": ["container$ebnf$1", "sized_container"], "postprocess": d => d[1]},
    {"name": "container$ebnf$2", "symbols": []},
    {"name": "container$ebnf$2", "symbols": ["container$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "container", "symbols": ["container$ebnf$2", "unsized_container"], "postprocess": d => d[1]},
    {"name": "sized_container", "symbols": ["sized_contents_with_subcontainers"], "postprocess": d => d[0]},
    {"name": "sized_container$ebnf$1", "symbols": []},
    {"name": "sized_container$ebnf$1", "symbols": ["sized_container$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_container", "symbols": ["sized_contents", "sized_container$ebnf$1", "subdivisions"], "postprocess": d => { return { dimension: d[0].dimension, empty: d[0].empty, subdivisions: d[2] }}},
    {"name": "sized_container", "symbols": ["sized_contents"], "postprocess": d => d[0]},
    {"name": "unsized_container", "symbols": ["unsized_contents_with_subcontainers"], "postprocess": d => d[0]},
    {"name": "unsized_container$ebnf$1", "symbols": []},
    {"name": "unsized_container$ebnf$1", "symbols": ["unsized_container$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "unsized_container", "symbols": ["unsized_contents", "unsized_container$ebnf$1", "subdivisions"], "postprocess": d => { return { dimension: d[0].dimension, empty: d[0].empty, subdivisions: d[2] }}},
    {"name": "unsized_container", "symbols": ["unsized_contents"], "postprocess": d => d[0]},
    {"name": "sized_contents$ebnf$1", "symbols": []},
    {"name": "sized_contents$ebnf$1", "symbols": ["sized_contents$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_contents$ebnf$2", "symbols": []},
    {"name": "sized_contents$ebnf$2", "symbols": ["sized_contents$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_contents", "symbols": [(lexer.has("ls") ? {type: "ls"} : ls), "sized_contents$ebnf$1", "dimension", "sized_contents$ebnf$2", (lexer.has("rs") ? {type: "rs"} : rs)], "postprocess": d => { return { dimension: d[2] }}},
    {"name": "sized_contents$ebnf$3", "symbols": []},
    {"name": "sized_contents$ebnf$3", "symbols": ["sized_contents$ebnf$3", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_contents$ebnf$4", "symbols": []},
    {"name": "sized_contents$ebnf$4", "symbols": ["sized_contents$ebnf$4", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_contents$ebnf$5", "symbols": []},
    {"name": "sized_contents$ebnf$5", "symbols": ["sized_contents$ebnf$5", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_contents", "symbols": [(lexer.has("ls") ? {type: "ls"} : ls), "sized_contents$ebnf$3", (lexer.has("prime") ? {type: "prime"} : prime), "sized_contents$ebnf$4", "dimension", "sized_contents$ebnf$5", (lexer.has("rs") ? {type: "rs"} : rs)], "postprocess": d => { return { dimension: d[4], empty: true }}},
    {"name": "sized_contents_with_subcontainers$ebnf$1", "symbols": []},
    {"name": "sized_contents_with_subcontainers$ebnf$1", "symbols": ["sized_contents_with_subcontainers$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_contents_with_subcontainers$ebnf$2", "symbols": []},
    {"name": "sized_contents_with_subcontainers$ebnf$2", "symbols": ["sized_contents_with_subcontainers$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "sized_contents_with_subcontainers", "symbols": [(lexer.has("ls") ? {type: "ls"} : ls), "sized_contents_with_subcontainers$ebnf$1", "dimension", "container_list_or_subdivisions", "sized_contents_with_subcontainers$ebnf$2", (lexer.has("rs") ? {type: "rs"} : rs)], "postprocess": d => { return { dimension: d[2], contents: d[3] }}},
    {"name": "unsized_contents$ebnf$1", "symbols": []},
    {"name": "unsized_contents$ebnf$1", "symbols": ["unsized_contents$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "unsized_contents", "symbols": [(lexer.has("ls") ? {type: "ls"} : ls), "unsized_contents$ebnf$1", (lexer.has("rs") ? {type: "rs"} : rs)], "postprocess": d => { return { dimension: undefined, subdivisions: {division: 1} }}},
    {"name": "unsized_contents$ebnf$2", "symbols": []},
    {"name": "unsized_contents$ebnf$2", "symbols": ["unsized_contents$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "unsized_contents$ebnf$3", "symbols": []},
    {"name": "unsized_contents$ebnf$3", "symbols": ["unsized_contents$ebnf$3", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "unsized_contents", "symbols": [(lexer.has("ls") ? {type: "ls"} : ls), "unsized_contents$ebnf$2", (lexer.has("prime") ? {type: "prime"} : prime), "unsized_contents$ebnf$3", (lexer.has("rs") ? {type: "rs"} : rs)], "postprocess": d => { return { dimension: undefined, empty: true, subdivisions: {division: 1} }}},
    {"name": "unsized_contents_with_subcontainers$ebnf$1", "symbols": []},
    {"name": "unsized_contents_with_subcontainers$ebnf$1", "symbols": ["unsized_contents_with_subcontainers$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "unsized_contents_with_subcontainers", "symbols": [(lexer.has("ls") ? {type: "ls"} : ls), "container_list_or_subdivisions", "unsized_contents_with_subcontainers$ebnf$1", (lexer.has("rs") ? {type: "rs"} : rs)], "postprocess": d => { return { dimension: { proportionality: "+", scale: 1 }, contents: d[1] }}},
    {"name": "dimension", "symbols": ["integer"], "postprocess": d => { return { proportionality: d[0], scale: new Fraction(1) }}},
    {"name": "dimension$ebnf$1", "symbols": []},
    {"name": "dimension$ebnf$1", "symbols": ["dimension$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "dimension", "symbols": [(lexer.has("comma") ? {type: "comma"} : comma), "dimension$ebnf$1", "ratio"], "postprocess": d => { return { proportionality: "+", scale: d[2] }}},
    {"name": "dimension$ebnf$2", "symbols": []},
    {"name": "dimension$ebnf$2", "symbols": ["dimension$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "dimension$ebnf$3", "symbols": []},
    {"name": "dimension$ebnf$3", "symbols": ["dimension$ebnf$3", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "dimension", "symbols": ["integer", "dimension$ebnf$2", (lexer.has("comma") ? {type: "comma"} : comma), "dimension$ebnf$3", "ratio"], "postprocess": d => { return { proportionality: d[0], scale: d[4] }}},
    {"name": "subdivisions$ebnf$1", "symbols": []},
    {"name": "subdivisions$ebnf$1", "symbols": ["subdivisions$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "subdivisions$ebnf$2", "symbols": ["ranged_container_list"], "postprocess": id},
    {"name": "subdivisions$ebnf$2", "symbols": [], "postprocess": function(d) {return null;}},
    {"name": "subdivisions$ebnf$3", "symbols": []},
    {"name": "subdivisions$ebnf$3", "symbols": ["subdivisions$ebnf$3", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "subdivisions", "symbols": [(lexer.has("lb") ? {type: "lb"} : lb), "subdivisions$ebnf$1", "integer", "subdivisions$ebnf$2", "subdivisions$ebnf$3", (lexer.has("rb") ? {type: "rb"} : rb)], "postprocess": d => {return { division: d[2], ranges: d[3] }}},
    {"name": "subdivisions$ebnf$4", "symbols": []},
    {"name": "subdivisions$ebnf$4", "symbols": ["subdivisions$ebnf$4", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "subdivisions$ebnf$5", "symbols": ["ranged_container_list"], "postprocess": id},
    {"name": "subdivisions$ebnf$5", "symbols": [], "postprocess": function(d) {return null;}},
    {"name": "subdivisions$ebnf$6", "symbols": []},
    {"name": "subdivisions$ebnf$6", "symbols": ["subdivisions$ebnf$6", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "subdivisions", "symbols": [(lexer.has("lb") ? {type: "lb"} : lb), "subdivisions$ebnf$4", "rotation", "subdivisions$ebnf$5", "subdivisions$ebnf$6", (lexer.has("rb") ? {type: "rb"} : rb)], "postprocess": d => {return { division: 1, rotation: d[2], ranges: d[3] }}},
    {"name": "subdivisions$ebnf$7", "symbols": []},
    {"name": "subdivisions$ebnf$7", "symbols": ["subdivisions$ebnf$7", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "subdivisions$ebnf$8", "symbols": []},
    {"name": "subdivisions$ebnf$8", "symbols": ["subdivisions$ebnf$8", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "subdivisions$ebnf$9", "symbols": ["ranged_container_list"], "postprocess": id},
    {"name": "subdivisions$ebnf$9", "symbols": [], "postprocess": function(d) {return null;}},
    {"name": "subdivisions$ebnf$10", "symbols": []},
    {"name": "subdivisions$ebnf$10", "symbols": ["subdivisions$ebnf$10", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "subdivisions", "symbols": [(lexer.has("lb") ? {type: "lb"} : lb), "subdivisions$ebnf$7", "integer", "subdivisions$ebnf$8", "rotation", "subdivisions$ebnf$9", "subdivisions$ebnf$10", (lexer.has("rb") ? {type: "rb"} : rb)], "postprocess": d => {return { division: d[2], rotation: d[4], ranges: d[5] }}},
    {"name": "rotation$ebnf$1", "symbols": []},
    {"name": "rotation$ebnf$1", "symbols": ["rotation$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "rotation", "symbols": [(lexer.has("lt") ? {type: "lt"} : lt), "rotation$ebnf$1", "ratio"], "postprocess": d => d[2].mul(-1)},
    {"name": "rotation$ebnf$2", "symbols": []},
    {"name": "rotation$ebnf$2", "symbols": ["rotation$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "rotation", "symbols": [(lexer.has("gt") ? {type: "gt"} : gt), "rotation$ebnf$2", "ratio"], "postprocess": d => d[2]},
    {"name": "ranged_container_list", "symbols": ["ranged_container"], "postprocess": d => [d[0]]},
    {"name": "ranged_container_list", "symbols": ["ranged_container", "ranged_container_list"], "postprocess": d => [d[0]].concat(d[1])},
    {"name": "ranged_container_list$ebnf$1", "symbols": []},
    {"name": "ranged_container_list$ebnf$1", "symbols": ["ranged_container_list$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ranged_container_list", "symbols": ["ranged_container", "ranged_container_list$ebnf$1", (lexer.has("underscore") ? {type: "underscore"} : underscore), "ranged_container_list"], "postprocess": d => { d[0].container.tie = true; return [d[0]].concat(d[3]); }},
    {"name": "ranged_container$ebnf$1", "symbols": []},
    {"name": "ranged_container$ebnf$1", "symbols": ["ranged_container$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ranged_container$ebnf$2", "symbols": []},
    {"name": "ranged_container$ebnf$2", "symbols": ["ranged_container$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ranged_container", "symbols": ["ranged_container$ebnf$1", "range", "ranged_container$ebnf$2", "unsized_container"], "postprocess": d => {return { range: d[1], container: d[3] }}},
    {"name": "ranged_container$ebnf$3", "symbols": []},
    {"name": "ranged_container$ebnf$3", "symbols": ["ranged_container$ebnf$3", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ranged_container$ebnf$4", "symbols": []},
    {"name": "ranged_container$ebnf$4", "symbols": ["ranged_container$ebnf$4", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ranged_container", "symbols": ["ranged_container$ebnf$3", "range", "ranged_container$ebnf$4", "subdivisions"], "postprocess": d => {return { range: d[1], container: { dimension: undefined, subdivisions: d[3] } }}},
    {"name": "ranged_container$ebnf$5", "symbols": []},
    {"name": "ranged_container$ebnf$5", "symbols": ["ranged_container$ebnf$5", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ranged_container", "symbols": ["ranged_container$ebnf$5", "range"], "postprocess": d => {return { range: d[1], container: { dimension: undefined, subdivisions: {division: 1} } }}},
    {"name": "range", "symbols": ["integer"], "postprocess": d => {return { index: d[0], length: 1 }}},
    {"name": "range$ebnf$1", "symbols": []},
    {"name": "range$ebnf$1", "symbols": ["range$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "range$ebnf$2", "symbols": []},
    {"name": "range$ebnf$2", "symbols": ["range$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "range", "symbols": ["integer", "range$ebnf$1", (lexer.has("colon") ? {type: "colon"} : colon), "range$ebnf$2", "integer"], "postprocess": d => {return { index: d[0], length: d[4] }}},
    {"name": "ratio", "symbols": ["integer"], "postprocess": d => new Fraction(d[0])},
    {"name": "ratio$ebnf$1", "symbols": []},
    {"name": "ratio$ebnf$1", "symbols": ["ratio$ebnf$1", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ratio$ebnf$2", "symbols": []},
    {"name": "ratio$ebnf$2", "symbols": ["ratio$ebnf$2", "_"], "postprocess": function arrpush(d) {return d[0].concat([d[1]]);}},
    {"name": "ratio", "symbols": ["integer", "ratio$ebnf$1", (lexer.has("slash") ? {type: "slash"} : slash), "ratio$ebnf$2", "integer"], "postprocess": d => new Fraction(d[0], d[4])},
    {"name": "integer", "symbols": [(lexer.has("unsigned_integer_tk") ? {type: "unsigned_integer_tk"} : unsigned_integer_tk)], "postprocess": d => parseInt(d.join(""))},
    {"name": "_", "symbols": [(lexer.has("ws") ? {type: "ws"} : ws)], "postprocess": d => { return null; }},
    {"name": "_", "symbols": [(lexer.has("comment") ? {type: "comment"} : comment)], "postprocess": d => { return null; }}
]
  , ParserStart: "nestup"
}
if (typeof module !== 'undefined'&& typeof module.exports !== 'undefined') {
   module.exports = grammar;
} else {
   window.grammar = grammar;
}
})();
